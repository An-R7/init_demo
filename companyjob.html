<html>
    <head>
        
        <link rel="stylesheet" href="ch.css">
        <link rel="stylesheet" href="company.css">
    </head>
    <body>

        
        

       <!--<div class="content">

            <form id="add-cafe-form"></form>-->
            
           <div class="add">
            <input type="button" class="home" value="Logout" id="logout" >
            <a class="active" href="#Profile">
                <input type="button" class="add" id="add" value="ADD">
                <img src="profile.png" alt=""></a>
                
           </div> 
           <div class="p-t-16">
            <button class="btn btn--radius-3 btn--blue" type="submit" id="submit">Profile</button>
        </div>
           
            <ul id="company-list"></ul>
            

        <script type="module">
            
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
    import { getFirestore,collection,getDocs,setDoc,doc,addDoc,getDoc,updateDoc} from "https://www.gstatic.com/firebasejs/9.8.3/firebase-firestore.js";
    //import { set,ref } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword ,signOut} from "https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyBjvk_raLlFLyMEANUS_KBlp7-6yj615mM",
        authDomain: "project-4d7bc.firebaseapp.com",
        projectId: "project-4d7bc",
        storageBucket: "project-4d7bc.appspot.com",
        messagingSenderId: "519355369103",
        appId: "1:519355369103:web:6cf899e7be6142489952fa",
        measurementId: "G-GQLMTQ8EXF"
      };
      const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth=getAuth();
  
          
      /*home.addActionListener('click',(e)=>
      {
        location.href="profile.html";
      })   */   

           




// create element & render cafe
function renderCompany(doc1){
    //let companyList=document.querySelector("#companyList")
    const companyList = document.querySelector('#company-list');
    let li = document.createElement('li');
    let name = document.createElement('span');
    let city = document.createElement('span');
    let button=document.createElement('button');
    li.setAttribute('data-id', doc1.id);
    name.textContent = doc1.id;
    city.textContent = doc1.data().cid;
    button.textContent="view result";
    button.type="submit";
    //button.id="submit";
    //console.log(doc1.data().name);
   
    li.appendChild(city);
    //name.appendChild(button);
    li.appendChild(button);
    li.appendChild(name);
    companyList.appendChild(li);
    //button.classList.add("btn btn--radius-3 btn--blue");
    //companyList.appendChild(li);
    const colref=collection(db,'todos1');
    const name1=document.querySelector('#name');
    button.addEventListener('click',(e)=>
    {async function yes(){
        //console.log(doc1.data().name);
    const ref=await updateDoc(doc(db,'todos1','jname'),{name:doc1.id})
    location.href="results.html";
    }
    yes()
}
    )
    
                
   /* button.addEventListener('click',(e)=>
    {console.log(doc1.data().cname);
    const ref=setDoc(doc(db,'todos1','name'),{name:doc1.data().cname})
    location.href="job.html";
    })*/
    //document.getElementById("button").onclick=function(){
        //location.href="signup.html";
    
    
    
    

        companyList.appendChild(li);

    //var toAdd = document.createDocumentFragment();

   /* let div=document.createElement('div');
    div.id=doc1.data().cid;
    div.appendChild(name);
    toAdd.appendChild(div);
    companyList.appendChild(toAdd);*/
    

}
logout.addEventListener('click',(e)=>{
                async function signing(){const refer=await signOut(auth).then(() => {
                 alert("sign-out succesful")
                    }).catch((error) => {
                     alert("try again")
                     });
                     location.href="sample.html"
                    }
                    signing()
                })      
            
let name;
auth.onAuthStateChanged(user=>{
            if(user){
                const u=user.uid;
               

                //let li = document.createElement('li');
                  //  let input=document.createElement('input');
                    //li.textContent="submit";
                    //li.appendChild(input);
                    //companyList.appendChild(li);
                    //var s=document.getElementById('inp').value;
                 
                    //console.log(v);
                    //console.log(document.getElementById('input'));
               function loop1(){
                //const v=document.querySelector('#inp').value;
                    async function GetDocument(){
                        const docref=doc(db,'signup-company',u) ;
    
        //var ref=doc(db,'signup-company',u);
        const docSnap1=await getDoc(docref);
        if(docSnap1.exists()){

//console.log(docSnap1.data().cname)
                const ref1=doc(db,'company req',docSnap1.data().cname)
const colref1=collection(ref1,docSnap1.data().cname)
getDocs(colref1).then((snapshot)=>
{
    snapshot.docs.forEach((doc)=>{
        renderCompany(doc);
    }
    )
})
        }
    }
    GetDocument()
}     
loop1()      
    submit.addEventListener('click',(e)=>{
                    
                   
                 
         
                  
                    location.href="company.html"
                  
             
         //console.log(s);
                })
            }})

// getting data


          </script>

        <script src="app.css"></script>
    </body>
</html>


